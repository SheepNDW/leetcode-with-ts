## 1504. Count Submatrices With All Ones

這題資料量很小，所以可以用暴力法 `O(MN^2)` 來解，做法很簡單，就是固定每一列 `i` 為底邊，然後計算每一直行 `j` 的直方圖高度 `height[j]`（連續 1 的高度）。接著對每個 `j` 往左邊掃描，把經過的最小高度 `minHeight` 累加到答案中，因為在固定底邊的情況下，以 `(i, j)` 為右下角的矩陣，往左邊擴展的每一格都能形成一個高度為 `minHeight` 的全 1 子矩陣。


不過此題有更巧妙的 `O(MN)` 解法，我們一樣逐列去處理，更新以第 `i` 列為底座的 histogram，然後逐行去處理每個柱子，我們用一個 monotonic stack 來判定以第 `j` 根柱子為右邊界的矩形有多少個。

想像一下如果 histogram 的柱子都是遞增的，那麼第 `j-1` 根柱子為右邊界的矩形有 `count[j-1]` 個，並且第 `j` 根比 `j-1` 高，那麼將這 `count[j-1]` 個矩形向右延伸靠到第 `j` 根柱子，就會形成有效的 `count[j]` 個矩形。此外我們只需要再計數僅包括第 `j` 根柱子本身的矩形即可，也就是：`count[j] = count[j-1] + height[j]`

如果第 `j` 根柱子比第 `j-1` 根矮，那就代表並不是所有的 `count[j-1]` 個矩形都能延伸到第 `j` 根柱子，我們需要將那些高度超過的矩形去掉，也就是高度差 `height[j] - height[j-1]` 的部分，然後萬一 `height[j-2]` 也高於 `height[j]`，那就要不斷地重複這個過程。

觀察到這個特性後，很自然地想到了 monotonic stack，在操作過程中要注意，假設 stack top 元素是 `p1`，次頂元素是 `p2`，`p1` 與 `p2` 不一定是相連的柱子，因為我們可能將 `p1` 與 `p2` 之間的柱子退出 stack 了。但這不代表中間就沒有柱子了，而是 `p1` 和 `p2` 之間存在與 `p1` 等高的柱子，所以我們在將 `p1` 退出 stack 時，同時要退出的矩形數是 `(p1 - p2) * (height[p1] - height[j])`
